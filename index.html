<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>For Mathi ‚Äî From Anson (Fixed Audio)</title>
<style>
:root{
  --bg1:#0b0b1c; --bg2:#1a1a40; --accent:#ff7aa2; --text:#f5f4f9; --muted:#b8b6c6; --card:rgba(255,255,255,0.05);
}
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:Segoe UI,system-ui,Roboto,Arial;background:linear-gradient(135deg,var(--bg1),var(--bg2));color:var(--text);overflow-x:hidden}
canvas{position:fixed;inset:0;z-index:0;pointer-events:none}
header{padding:36px 20px;text-align:center;z-index:1}
header h1{font-size:2.4rem;color:var(--accent)}
header p{color:var(--muted);margin-top:8px}

/* timeline */
.container{max-width:880px;margin:24px auto;position:relative;z-index:2;padding:0 18px}
.card{background:var(--card);padding:18px;border-radius:12px;margin-bottom:16px;border:1px solid rgba(255,255,255,0.02);animation:slideIn .9s ease forwards;opacity:0}
.card h3{color:var(--accent);margin-bottom:6px}
.card p{color:var(--muted);line-height:1.5}

/* center button */
.center{text-align:center;margin:26px 0}
.btn{padding:12px 22px;border-radius:999px;border:0;background:linear-gradient(90deg,#ff8bb2,#ffb3d0);color:#2a0018;font-weight:700;font-size:1.05rem;cursor:pointer;transition:transform .18s,box-shadow .18s}
.btn:hover{transform:scale(1.04);box-shadow:0 8px 30px rgba(255,120,180,0.12)}

/* overlay */
.overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.78);backdrop-filter:blur(6px);opacity:0;pointer-events:none;transition:opacity .28s ease;z-index:200}
.overlay.show{opacity:1;pointer-events:auto}
.modal{background:white;color:#2a0018;padding:26px;border-radius:12px;max-width:760px;width:92%;box-shadow:0 36px 90px rgba(0,0,0,0.6)}
.modal h2{margin-bottom:10px}
.modal p{color:#4a2b3f;line-height:1.6;margin-bottom:12px}
.row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
.small{font-size:0.9rem;color:#6b5963}

/* audio controls area */
.audio-controls{margin-top:12px;display:flex;gap:10px;align-items:center;justify-content:flex-start}
#playMusicBtn{background:linear-gradient(90deg,#ffd1e8,#ffc2d9);color:#3b0230;border-radius:10px;padding:8px 12px;border:0;cursor:pointer}
#audioStatus{color:#6b5963;font-size:0.95rem}

/* responsive */
@keyframes slideIn{from{opacity:0;transform:translateX(-22px)}to{opacity:1;transform:none}}
@media(max-width:560px){header h1{font-size:1.6rem}}
</style>
</head>
<body>

<canvas id="hearts"></canvas>

<header>
  <h1>To Mathi ‚ù§Ô∏è</h1>
  <p>Our memories, my heart, and my promise ‚Äî click to open my heart.</p>
</header>

<div class="container">
  <div class="card" style="animation-delay:.25s"><h3>Seventh Grade</h3><p>We shared unforgettable, silly moments that still make me smile.</p></div>
  <div class="card" style="animation-delay:.45s"><h3>Reunited in Tenth</h3><p>After some time apart we met again for MC ‚Äî it felt like home to me.</p></div>
  <div class="card" style="animation-delay:.65s"><h3>The Park Near Your House</h3><p>You cared for me there in a small, perfect way I still remember.</p></div>
  <div class="card" style="animation-delay:.85s"><h3>Late Night Talks</h3><p>Before the Euro Cup and during the shows ‚Äî our chats felt like our own world.</p></div>
  <div class="card" style="animation-delay:1.05s"><h3>Talent Festival</h3><p>You said I would always stand by you ‚Äî I carry that promise with me.</p></div>

  <div class="center">
    <button id="openBtn" class="btn">Open My Heart ‚ù§Ô∏è</button>
  </div>
</div>

<!-- overlay -->
<div class="overlay" id="overlay" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true">
    <h2>Mathi, I‚Äôm Sorry‚Ä¶</h2>
    <p>Mathi, these past months without you have been quiet and heavy. I know studying and family pressure has been hard. I‚Äôm sorry for any part I played in making things worse. I want to be the gentle support you need ‚Äî I will wait for you until your studies are finished, patiently and proudly.</p>
    <p>I miss our small laughs, our late-night talks, and the comfort of your voice. I‚Äôm not asking for anything now ‚Äî just the chance to be near in any way you accept. When you‚Äôre ready, I‚Äôll be here ‚Äî always on your side. I love you.</p>

    <div class="audio-controls">
      <button id="playMusicBtn">‚ñ∂ Play soundtrack</button>
      <div id="audioStatus" class="small">Audio not started</div>
    </div>

    <div style="margin-top:14px;display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
      <div class="small">If audio doesn't start, try Chrome/Edge or host the file on GitHub Pages. See console for errors.</div>
      <div style="display:flex;gap:8px">
        <button id="closeBtn" class="btn" style="background:#2a0018;color:#fff">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- primary audio (remote). Two sources included; CORS may still block -- fallback provided below. -->
<audio id="bgMusic" crossorigin="anonymous" preload="auto">
  <source src="https://files.freemusicarchive.org/storage-freemusicarchive-org/music/no_curator/Komiku/The_Safe_Side/Komiku_-_05_-_Opening_Credits.mp3" type="audio/mpeg">
  <source src="https://cdn.pixabay.com/audio/2022/03/15/audio_2f0d6f7a5b.mp3" type="audio/mpeg">
  Your browser does not support the audio element.
</audio>

<script>
/* ---------- Hearts (background) ---------- */
const canvas = document.getElementById('hearts');
const ctx = canvas.getContext('2d');
function resize(){ canvas.width = innerWidth; canvas.height = innerHeight; }
resize(); addEventListener('resize', resize);

const hearts = Array.from({length:26}, ()=>({
  x: Math.random()*innerWidth,
  y: Math.random()*innerHeight,
  s: Math.random()*26 + 10,
  speed: Math.random()*0.9 + 0.2,
  drift: Math.random()*0.6 - 0.3,
  hue: Math.random()*40 + 320
}));

function drawHeart(x,y,s,hue){
  ctx.save(); ctx.translate(x,y); ctx.scale(s/40,s/40);
  ctx.beginPath();
  ctx.moveTo(0,-10);
  ctx.bezierCurveTo(-12,-30,-40,-12,-40,8);
  ctx.bezierCurveTo(-40,34,-8,48,0,62);
  ctx.bezierCurveTo(8,48,40,34,40,8);
  ctx.bezierCurveTo(40,-12,12,-30,0,-10);
  ctx.closePath();
  ctx.fillStyle = `hsla(${hue},80%,62%,0.88)`;
  ctx.fill(); ctx.restore();
}
function animateHearts(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(const h of hearts){
    drawHeart(h.x, h.y, h.s, h.hue);
    h.y -= h.speed; h.x += h.drift;
    if(h.y < -80){ h.y = canvas.height + 80; h.x = Math.random()*canvas.width; }
  }
  requestAnimationFrame(animateHearts);
}
animateHearts();

/* ---------- Elements ---------- */
const openBtn = document.getElementById('openBtn');
const overlay = document.getElementById('overlay');
const playMusicBtn = document.getElementById('playMusicBtn');
const audioStatus = document.getElementById('audioStatus');
const closeBtn = document.getElementById('closeBtn');
const music = document.getElementById('bgMusic');

let usingFallback = false;
let fallbackCtx = null;

/* helper to set status text */
function setStatus(text){
  audioStatus.textContent = text;
}

/* Attempt to play the remote audio. If it fails, fallback to synth. */
async function tryPlayRemoteAudio(){
  setStatus('Attempting to play soundtrack‚Ä¶');
  // some browsers require AudioContext resume first (if previously suspended)
  try{
    await music.play();
    setStatus('Soundtrack playing üéµ');
    playMusicBtn.style.display = 'none';
    usingFallback = false;
    console.log('Remote audio started');
  }catch(err){
    console.warn('Remote audio play failed:', err);
    setStatus('Remote audio failed ‚Äî using fallback instrument');
    playMusicBtn.style.display = 'inline-block';
    playFallbackPad(); // automatically fall back
  }
}

/* Play a gentle ambient pad using WebAudio (fallback) */
function playFallbackPad(){
  try{
    if(fallbackCtx && fallbackCtx.state === 'suspended') { fallbackCtx.resume(); setStatus('Playing fallback (synth)'); return; }
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    fallbackCtx = ctx;
    const master = ctx.createGain(); master.gain.value = 0.0001; master.connect(ctx.destination);

    // create three detuned oscillators for a pad
    const freqs = [220, 277.18, 330]; // warm triad
    const oss = freqs.map((f,i)=>{
      const o = ctx.createOscillator();
      o.type = i===1 ? 'sine' : 'triangle';
      o.frequency.value = f * (1 + (Math.random()*0.006 - 0.003)); // tiny detune
      const g = ctx.createGain(); g.gain.value = 0;
      const filt = ctx.createBiquadFilter(); filt.type='lowpass'; filt.frequency.value = 1200;
      o.connect(g); g.connect(filt); filt.connect(master);
      o.start();
      g.gain.linearRampToValueAtTime(0.04 + Math.random()*0.02, ctx.currentTime + 0.6);
      return {o,g,filt};
    });

    // soft attack to audible level
    master.gain.linearRampToValueAtTime(0.06, ctx.currentTime + 1.2);
    usingFallback = true;
    setStatus('Playing fallback soundtrack (synth)');

    // keep playing until user closes overlay or stops it
    window.stopFallback = () => {
      if(!fallbackCtx) return;
      const t = fallbackCtx.currentTime;
      master.gain.cancelScheduledValues(t);
      master.gain.linearRampToValueAtTime(0.0001, t + 1.5);
      setTimeout(()=>{
        oss.forEach(o=>{ try{o.o.stop()}catch(e){} });
        try{ fallbackCtx.close() }catch(e){}
        fallbackCtx = null;
        setStatus('Fallback stopped');
      },1600);
    };

  }catch(err){
    console.error('Fallback synth failed:', err);
    setStatus('Audio not available (see console).');
  }
}

/* Event: open overlay (user gesture) */
openBtn.addEventListener('click', async ()=>{
  overlay.classList.add('show');
  overlay.setAttribute('aria-hidden','false');
  // first try the remote file ‚Äî user click should allow playback
  tryPlayRemoteAudio();
});

/* Play button inside overlay (explicit) */
playMusicBtn.addEventListener('click', async ()=>{
  // explicit user gesture: try remote first, otherwise fallback
  setStatus('User requested soundtrack...');
  try{
    await music.play();
    setStatus('Soundtrack playing üéµ');
    playMusicBtn.style.display = 'none';
    usingFallback = false;
  }catch(err){
    console.warn('Play button could not start remote audio:', err);
    setStatus('Remote audio blocked or unavailable ‚Äî using fallback');
    playFallbackPad();
  }
});

/* If audio element emits an error -> fallback */
music.addEventListener('error', (e)=>{
  console.warn('Audio element error:', e);
  setStatus('Remote audio error ‚Äî using fallback instrument');
  playFallbackPad();
});

/* If the remote audio becomes ready to play */
music.addEventListener('canplaythrough', ()=>{
  console.log('Remote audio can play through');
});

/* Close overlay: stop audio if fallback, pause remote if playing */
closeBtn.addEventListener('click', ()=>{
  overlay.classList.remove('show');
  overlay.setAttribute('aria-hidden','true');
  // stop fallback if in use
  if(usingFallback && typeof window.stopFallback === 'function') window.stopFallback();
  // pause remote audio
  if(!usingFallback && !music.paused){
    music.pause();
    music.currentTime = 0;
    setStatus('Soundtrack paused');
  }
});

/* Accessibility: Escape closes overlay */
addEventListener('keydown', (e)=>{
  if(e.key === 'Escape' && overlay.classList.contains('show')){ closeBtn.click(); }
});

/* Helpful tip printed to console for debugging */
console.log('%cDebug hints: If audio does not play, open DevTools Console (Ctrl+Shift+I) to see errors. If running locally (file://), consider serving via a simple HTTP server: `python -m http.server 8000` and open http://localhost:8000', 'color:#9bd;');
</script>
</body>
</html>

